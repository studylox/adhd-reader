{"ast":null,"code":"// 高亮颜色变量\nlet currentHighlightColor = '#ff0000'; // ADHD默认模式的红色\n\n// 模式切换\nfunction toggleMode(mode) {\n  const content = document.querySelector('.page-content');\n  if (mode === 'adhd') {\n    content.classList.add('adhd-default-mode');\n    currentHighlightColor = '#ff0000'; // ADHD模式下使用红色\n    setHighlightColor('#ff0000');\n  } else {\n    content.classList.remove('adhd-default-mode');\n  }\n}\n\n// 词性高亮\nfunction highlightByPOS(pos) {\n  const text = document.querySelector('.page-content');\n  const words = text.textContent.split(/\\s+/);\n\n  // 这里应该调用词性标注API\n  // 示例实现\n  words.forEach(word => {\n    const span = document.createElement('span');\n    span.textContent = word + ' ';\n    span.className = `pos-highlight ${pos}`;\n    text.appendChild(span);\n  });\n}\n\n// 自定义高亮\nfunction createHighlight(color) {\n  const selection = window.getSelection();\n  if (selection.toString().length > 0) {\n    const span = document.createElement('span');\n    span.className = 'highlight';\n    span.style.backgroundColor = color;\n    selection.getRangeAt(0).surroundContents(span);\n    saveHighlights();\n  }\n}\n\n// 保存高亮\nfunction saveHighlights() {\n  const highlights = Array.from(document.querySelectorAll('.highlight')).map(h => ({\n    text: h.textContent,\n    color: h.style.backgroundColor,\n    position: getElementPosition(h)\n  }));\n  localStorage.setItem('highlights', JSON.stringify(highlights));\n}\n\n// 加载高亮\nfunction loadHighlights() {\n  const highlights = JSON.parse(localStorage.getItem('highlights') || '[]');\n  highlights.forEach(h => {\n    const span = document.createElement('span');\n    span.className = 'highlight';\n    span.style.backgroundColor = h.color;\n    span.textContent = h.text;\n    // 根据position插入到正确位置\n    insertAtPosition(span, h.position);\n  });\n}\n\n// 获取元素位置\nfunction getElementPosition(element) {\n  const rect = element.getBoundingClientRect();\n  return {\n    top: rect.top,\n    left: rect.left,\n    width: rect.width,\n    height: rect.height\n  };\n}\n\n// 在指定位置插入元素\nfunction insertAtPosition(element, position) {\n  // 实现插入逻辑\n}\n\n// 设置高亮颜色\nfunction setHighlightColor(color) {\n  currentHighlightColor = color;\n  document.documentElement.style.setProperty('--highlight-color', color);\n  // 更新所有现有高亮的颜色\n  document.querySelectorAll('.highlight').forEach(highlight => {\n    highlight.style.backgroundColor = color;\n  });\n}\n\n// 初始化阅读器\nexport const initializeReader = () => {\n  // 等待DOM加载完成\n  const initializeEvents = () => {\n    const textLayer = document.querySelector('.textLayer');\n    if (!textLayer) return;\n\n    // 添加文本选择事件监听器\n    textLayer.addEventListener('mouseup', () => {\n      const selection = window.getSelection();\n      if (!selection.toString().length) return;\n      try {\n        const range = selection.getRangeAt(0);\n        const span = document.createElement('span');\n        span.className = 'highlight';\n\n        // 获取当前高亮颜色\n        const color = document.documentElement.style.getPropertyValue('--highlight-color') || '#ff0000';\n        span.style.backgroundColor = color;\n\n        // 包装选中的文本\n        range.surroundContents(span);\n\n        // 保存高亮\n        saveHighlights();\n      } catch (err) {\n        console.error('创建高亮失败:', err);\n      }\n    });\n  };\n\n  // 使用MutationObserver监听DOM变化\n  const observer = new MutationObserver(mutations => {\n    mutations.forEach(mutation => {\n      if (mutation.addedNodes.length) {\n        const textLayer = document.querySelector('.textLayer');\n        if (textLayer) {\n          initializeEvents();\n          observer.disconnect(); // 找到元素后停止观察\n        }\n      }\n    });\n  });\n\n  // 开始观察DOM变化\n  observer.observe(document.body, {\n    childList: true,\n    subtree: true\n  });\n};\n\n// 将函数暴露到全局作用域\nwindow.toggleMode = toggleMode;\nwindow.highlightByPOS = highlightByPOS;\nwindow.setHighlightColor = setHighlightColor;\nwindow.createHighlight = createHighlight;","map":{"version":3,"names":["currentHighlightColor","toggleMode","mode","content","document","querySelector","classList","add","setHighlightColor","remove","highlightByPOS","pos","text","words","textContent","split","forEach","word","span","createElement","className","appendChild","createHighlight","color","selection","window","getSelection","toString","length","style","backgroundColor","getRangeAt","surroundContents","saveHighlights","highlights","Array","from","querySelectorAll","map","h","position","getElementPosition","localStorage","setItem","JSON","stringify","loadHighlights","parse","getItem","insertAtPosition","element","rect","getBoundingClientRect","top","left","width","height","documentElement","setProperty","highlight","initializeReader","initializeEvents","textLayer","addEventListener","range","getPropertyValue","err","console","error","observer","MutationObserver","mutations","mutation","addedNodes","disconnect","observe","body","childList","subtree"],"sources":["D:/adhd-read-helper/src/utils/readerUtils.js"],"sourcesContent":["// 高亮颜色变量\r\nlet currentHighlightColor = '#ff0000'; // ADHD默认模式的红色\r\n\r\n// 模式切换\r\nfunction toggleMode(mode) {\r\n  const content = document.querySelector('.page-content');\r\n  if (mode === 'adhd') {\r\n    content.classList.add('adhd-default-mode');\r\n    currentHighlightColor = '#ff0000'; // ADHD模式下使用红色\r\n    setHighlightColor('#ff0000');\r\n  } else {\r\n    content.classList.remove('adhd-default-mode');\r\n  }\r\n}\r\n\r\n// 词性高亮\r\nfunction highlightByPOS(pos) {\r\n  const text = document.querySelector('.page-content');\r\n  const words = text.textContent.split(/\\s+/);\r\n  \r\n  // 这里应该调用词性标注API\r\n  // 示例实现\r\n  words.forEach(word => {\r\n    const span = document.createElement('span');\r\n    span.textContent = word + ' ';\r\n    span.className = `pos-highlight ${pos}`;\r\n    text.appendChild(span);\r\n  });\r\n}\r\n\r\n// 自定义高亮\r\nfunction createHighlight(color) {\r\n  const selection = window.getSelection();\r\n  if (selection.toString().length > 0) {\r\n    const span = document.createElement('span');\r\n    span.className = 'highlight';\r\n    span.style.backgroundColor = color;\r\n    selection.getRangeAt(0).surroundContents(span);\r\n    saveHighlights();\r\n  }\r\n}\r\n\r\n// 保存高亮\r\nfunction saveHighlights() {\r\n  const highlights = Array.from(document.querySelectorAll('.highlight')).map(h => ({\r\n    text: h.textContent,\r\n    color: h.style.backgroundColor,\r\n    position: getElementPosition(h)\r\n  }));\r\n  localStorage.setItem('highlights', JSON.stringify(highlights));\r\n}\r\n\r\n// 加载高亮\r\nfunction loadHighlights() {\r\n  const highlights = JSON.parse(localStorage.getItem('highlights') || '[]');\r\n  highlights.forEach(h => {\r\n    const span = document.createElement('span');\r\n    span.className = 'highlight';\r\n    span.style.backgroundColor = h.color;\r\n    span.textContent = h.text;\r\n    // 根据position插入到正确位置\r\n    insertAtPosition(span, h.position);\r\n  });\r\n}\r\n\r\n// 获取元素位置\r\nfunction getElementPosition(element) {\r\n  const rect = element.getBoundingClientRect();\r\n  return {\r\n    top: rect.top,\r\n    left: rect.left,\r\n    width: rect.width,\r\n    height: rect.height\r\n  };\r\n}\r\n\r\n// 在指定位置插入元素\r\nfunction insertAtPosition(element, position) {\r\n  // 实现插入逻辑\r\n}\r\n\r\n// 设置高亮颜色\r\nfunction setHighlightColor(color) {\r\n  currentHighlightColor = color;\r\n  document.documentElement.style.setProperty('--highlight-color', color);\r\n  // 更新所有现有高亮的颜色\r\n  document.querySelectorAll('.highlight').forEach(highlight => {\r\n    highlight.style.backgroundColor = color;\r\n  });\r\n}\r\n\r\n// 初始化阅读器\r\nexport const initializeReader = () => {\r\n  // 等待DOM加载完成\r\n  const initializeEvents = () => {\r\n    const textLayer = document.querySelector('.textLayer');\r\n    if (!textLayer) return;\r\n\r\n    // 添加文本选择事件监听器\r\n    textLayer.addEventListener('mouseup', () => {\r\n      const selection = window.getSelection();\r\n      if (!selection.toString().length) return;\r\n\r\n      try {\r\n        const range = selection.getRangeAt(0);\r\n        const span = document.createElement('span');\r\n        span.className = 'highlight';\r\n        \r\n        // 获取当前高亮颜色\r\n        const color = document.documentElement.style.getPropertyValue('--highlight-color') || '#ff0000';\r\n        span.style.backgroundColor = color;\r\n        \r\n        // 包装选中的文本\r\n        range.surroundContents(span);\r\n        \r\n        // 保存高亮\r\n        saveHighlights();\r\n      } catch (err) {\r\n        console.error('创建高亮失败:', err);\r\n      }\r\n    });\r\n  };\r\n\r\n  // 使用MutationObserver监听DOM变化\r\n  const observer = new MutationObserver((mutations) => {\r\n    mutations.forEach((mutation) => {\r\n      if (mutation.addedNodes.length) {\r\n        const textLayer = document.querySelector('.textLayer');\r\n        if (textLayer) {\r\n          initializeEvents();\r\n          observer.disconnect(); // 找到元素后停止观察\r\n        }\r\n      }\r\n    });\r\n  });\r\n\r\n  // 开始观察DOM变化\r\n  observer.observe(document.body, {\r\n    childList: true,\r\n    subtree: true\r\n  });\r\n};\r\n\r\n// 将函数暴露到全局作用域\r\nwindow.toggleMode = toggleMode;\r\nwindow.highlightByPOS = highlightByPOS;\r\nwindow.setHighlightColor = setHighlightColor;\r\nwindow.createHighlight = createHighlight; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}